{"version":3,"sources":["../../src/datasource.js"],"names":["HawkularDatasource","instanceSettings","$q","backendSrv","templateSrv","type","url","name","q","headers","jsonData","tenant","basicAuth","length","token","typeResources","variables","capabilitiesPromise","queryVersion","then","version","queryProcessor","options","validTargets","targets","filter","target","hide","map","id","undefined","tags","tagsQL","when","data","promises","run","all","flatten","responses","sort","m1","m2","localeCompare","datasourceRequest","method","response","status","message","title","start","range","from","valueOf","end","to","order","ids","annotation","query","annot","time","dp","timestamp","text","value","key","hasOwnProperty","push","replace","join","resolveToString","result","m","tag","params","substr","findTags","trim","charAt","runWithResolvedVariables","p","metric","pattern","flatTags","property","concat","func","resolved","resolve","catch"],"mappings":";;;;;;;;;AAAA;;;;AACA;;AACA;;AACA;;AACA;;;;;;IAEaA,kB,WAAAA,kB;AAEX,8BAAYC,gBAAZ,EAA8BC,EAA9B,EAAkCC,UAAlC,EAA8CC,WAA9C,EAA2D;AAAA;;AACzD,SAAKC,IAAL,GAAYJ,iBAAiBI,IAA7B;AACA,SAAKC,GAAL,GAAWL,iBAAiBK,GAA5B;AACA,SAAKC,IAAL,GAAYN,iBAAiBM,IAA7B;AACA,SAAKC,CAAL,GAASN,EAAT;AACA,SAAKC,UAAL,GAAkBA,UAAlB;AACA,SAAKM,OAAL,GAAe;AACb,sBAAgB,kBADH;AAEb,yBAAmBR,iBAAiBS,QAAjB,CAA0BC;AAFhC,KAAf;AAIA,QAAI,OAAOV,iBAAiBW,SAAxB,KAAsC,QAAtC,IAAkDX,iBAAiBW,SAAjB,CAA2BC,MAA3B,GAAoC,CAA1F,EAA6F;AAC3F,WAAKJ,OAAL,CAAa,eAAb,IAAgCR,iBAAiBW,SAAjD;AACD,KAFD,MAEO,IAAI,OAAOX,iBAAiBS,QAAjB,CAA0BI,KAAjC,KAA2C,QAA3C,IAAuDb,iBAAiBS,QAAjB,CAA0BI,KAA1B,CAAgCD,MAAhC,GAAyC,CAApG,EAAuG;AAC5G,WAAKJ,OAAL,CAAa,eAAb,IAAgC,YAAYR,iBAAiBS,QAAjB,CAA0BI,KAAtE;AACD;AACD,SAAKC,aAAL,GAAqB;AACnB,eAAS,QADU;AAEnB,iBAAW,UAFQ;AAGnB,sBAAgB;AAHG,KAArB;AAKA,SAAKC,SAAL,GAAiB,yBAAcZ,WAAd,CAAjB;AACA,SAAKa,mBAAL,GAA2B,KAAKC,YAAL,GAAoBC,IAApB,CAAyB;AAAA,aAAW,+BAAiBC,OAAjB,CAAX;AAAA,KAAzB,CAA3B;AACA,SAAKC,cAAL,GAAsB,mCAAmBnB,EAAnB,EAAuBC,UAAvB,EAAmC,KAAKa,SAAxC,EAAmD,KAAKC,mBAAxD,EAA6E,KAAKX,GAAlF,EAAuF,KAAKG,OAA5F,EAAqG,KAAKM,aAA1G,CAAtB;AACD;;;;0BAEKO,O,EAAS;AAAA;;AACb,UAAMC,eAAeD,QAAQE,OAAR,CAClBC,MADkB,CACX;AAAA,eAAU,CAACC,OAAOC,IAAlB;AAAA,OADW,EAElBC,GAFkB,CAEd,kBAAU;AACb,YAAIF,OAAOG,EAAP,KAAcC,SAAd,IAA2BJ,OAAOA,MAAP,KAAkB,eAAjD,EAAkE;AAChE;AACAA,iBAAOG,EAAP,GAAYH,OAAOA,MAAnB;AACD,SAHD,MAGO,IAAIA,OAAOG,EAAP,KAAc,YAAlB,EAAgC;AACrC,iBAAOH,OAAOG,EAAd;AACD;AACD,eAAOH,MAAP;AACD,OAVkB,EAWlBD,MAXkB,CAWX;AAAA,eAAUC,OAAOG,EAAP,KAAcC,SAAd,IACXJ,OAAOK,IAAP,KAAgBD,SAAhB,IAA6BJ,OAAOK,IAAP,CAAYlB,MAAZ,GAAqB,CADvC,IAEXa,OAAOM,MAAP,KAAkBF,SAAlB,IAA+BJ,OAAOM,MAAP,CAAcnB,MAAd,GAAuB,CAFrD;AAAA,OAXW,CAArB;;AAeA,UAAIU,aAAaV,MAAb,KAAwB,CAA5B,EAA+B;AAC7B,eAAO,KAAKL,CAAL,CAAOyB,IAAP,CAAY,EAACC,MAAM,EAAP,EAAZ,CAAP;AACD;;AAED,UAAMC,WAAWZ,aAAaK,GAAb,CAAiB;AAAA,eAAU,MAAKP,cAAL,CAAoBe,GAApB,CAAwBV,MAAxB,EAAgCJ,OAAhC,CAAV;AAAA,OAAjB,CAAjB;;AAEA,aAAO,KAAKd,CAAL,CAAO6B,GAAP,CAAWF,QAAX,EACJhB,IADI,CACC;AAAA,eAAc,EAACe,MAAM,iBAAEI,OAAF,CAAUC,SAAV,EAAqBC,IAArB,CAA0B,UAACC,EAAD,EAAKC,EAAL;AAAA,mBAAYD,GAAGf,MAAH,CAAUiB,aAAV,CAAwBD,GAAGhB,MAA3B,CAAZ;AAAA,WAA1B,CAAP,EAAd;AAAA,OADD,CAAP;AAED;;;qCAEgB;AACf,aAAO,KAAKvB,UAAL,CAAgByC,iBAAhB,CAAkC;AACvCtC,aAAK,KAAKA,GAAL,GAAW,UADuB;AAEvCuC,gBAAQ,KAF+B;AAGvCpC,iBAAS,KAAKA;AAHyB,OAAlC,EAIJU,IAJI,CAIC,oBAAY;AAClB,YAAI2B,SAASC,MAAT,KAAoB,GAApB,IAA2BD,SAASC,MAAT,KAAoB,GAAnD,EAAwD;AACtD,iBAAO,EAAEA,QAAQ,SAAV,EAAqBC,SAAS,wBAA9B,EAAwDC,OAAO,SAA/D,EAAP;AACD,SAFD,MAEO;AACL,iBAAO,EAAEF,QAAQ,OAAV,EAAmBC,SAAS,wBAAwBF,SAASC,MAAjC,GAA0C,GAAtE,EAA2EE,OAAO,OAAlF,EAAP;AACD;AACF,OAVM,CAAP;AAWD;;;oCAEe3B,O,EAAS;AACvB,aAAO,KAAKnB,UAAL,CAAgByC,iBAAhB,CAAkC;AACvCtC,aAAK,KAAKA,GAAL,GAAW,oBADuB;AAEvC4B,cAAM;AACJgB,iBAAO5B,QAAQ6B,KAAR,CAAcC,IAAd,CAAmBC,OAAnB,EADH;AAEJC,eAAKhC,QAAQ6B,KAAR,CAAcI,EAAd,CAAiBF,OAAjB,EAFD;AAGJG,iBAAO,KAHH;AAIJC,eAAK,CAACnC,QAAQoC,UAAR,CAAmBC,KAApB;AAJD,SAFiC;AAQvCd,gBAAQ,MAR+B;AASvCpC,iBAAS,KAAKA;AATyB,OAAlC,EAUJU,IAVI,CAUC;AAAA,eAAY2B,SAASC,MAAT,IAAmB,GAAnB,GAAyBD,SAASZ,IAAT,CAAc,CAAd,EAAiBA,IAA1C,GAAiD,EAA7D;AAAA,OAVD,EAWNf,IAXM,CAWD;AAAA,eAAQe,KAAKN,GAAL,CAAS,cAAM;AAC3B,cAAIgC,QAAQ;AACVF,wBAAYpC,QAAQoC,UADV;AAEVG,kBAAMC,GAAGC,SAFC;AAGVd,mBAAO3B,QAAQoC,UAAR,CAAmBnD,IAHhB;AAIVwB,kBAAMD,SAJI;AAKVkC,kBAAMF,GAAGG;AALC,WAAZ;AAOA,cAAIH,GAAG/B,IAAP,EAAa;AACX,gBAAIA,OAAO,EAAX;AACA,iBAAK,IAAImC,GAAT,IAAgBJ,GAAG/B,IAAnB,EAAyB;AACvB,kBAAI+B,GAAG/B,IAAH,CAAQoC,cAAR,CAAuBD,GAAvB,CAAJ,EAAiC;AAC/BnC,qBAAKqC,IAAL,CAAUN,GAAG/B,IAAH,CAAQmC,GAAR,EAAaG,OAAb,CAAqB,GAArB,EAA0B,GAA1B,CAAV;AACD;AACF;AACD,gBAAItC,KAAKlB,MAAL,GAAc,CAAlB,EAAqB;AACnB+C,oBAAM7B,IAAN,GAAaA,KAAKuC,IAAL,CAAU,GAAV,CAAb;AACD;AACF;AACD,iBAAOV,KAAP;AACD,SApBa,CAAR;AAAA,OAXC,CAAP;AAgCD;;;mCAEclC,M,EAAQ;AACrB,UAAIpB,MAAM,KAAKA,GAAL,GAAW,gBAAX,GAA8BoB,OAAOrB,IAA/C;AACA,UAAIqB,OAAOM,MAAP,IAAiBN,OAAOM,MAAP,CAAcnB,MAAd,GAAuB,CAA5C,EAA+C;AAC7CP,eAAO,WAAW,KAAKU,SAAL,CAAeuD,eAAf,CAA+B7C,OAAOM,MAAtC,EAA8C,EAA9C,CAAlB;AACD,OAFD,MAEO,IAAIN,OAAOK,IAAP,IAAeL,OAAOK,IAAP,CAAYlB,MAAZ,GAAqB,CAAxC,EAA2C;AAChDP,eAAO,WAAW,0CAAkBoB,OAAOK,IAAzB,EAA+B,KAAKf,SAApC,EAA+C,EAA/C,CAAlB;AACD;AACD,aAAO,KAAKb,UAAL,CAAgByC,iBAAhB,CAAkC;AACvCtC,aAAKA,GADkC;AAEvCuC,gBAAQ,KAF+B;AAGvCpC,iBAAS,KAAKA;AAHyB,OAAlC,EAIJU,IAJI,CAIC;AAAA,eAAY2B,SAASC,MAAT,IAAmB,GAAnB,GAAyBD,SAASZ,IAAlC,GAAyC,EAArD;AAAA,OAJD,EAKNf,IALM,CAKD,kBAAU;AACd,eAAOqD,OAAO5C,GAAP,CAAW;AAAA,iBAAK6C,EAAE5C,EAAP;AAAA,SAAX,EACJW,IADI,GAEJZ,GAFI,CAEA,cAAM;AACT,iBAAO,EAACoC,MAAMnC,EAAP,EAAWoC,OAAOpC,EAAlB,EAAP;AACD,SAJI,CAAP;AAKD,OAXM,CAAP;AAYD;;;gCAEWxB,I,EAAM6D,G,EAAK;AACrB,UAAI,CAACA,GAAL,EAAU;AACR,eAAO,KAAK1D,CAAL,CAAOyB,IAAP,CAAY,EAAZ,CAAP;AACD;AACD,aAAO,KAAK9B,UAAL,CAAgByC,iBAAhB,CAAkC;AACvCtC,aAAK,KAAKA,GAAL,GAAW,GAAX,GAAiB,KAAKS,aAAL,CAAmBV,IAAnB,CAAjB,GAA4C,QAA5C,GAAuD6D,GAAvD,GAA6D,IAD3B;AAEvCrB,gBAAQ,KAF+B;AAGvCpC,iBAAS,KAAKA;AAHyB,OAAlC,EAIJU,IAJI,CAIC;AAAA,eAAUqD,OAAOtC,IAAP,CAAYiC,cAAZ,CAA2BD,GAA3B,IAAkCM,OAAOtC,IAAP,CAAYgC,GAAZ,CAAlC,GAAqD,EAA/D;AAAA,OAJD,EAKN/C,IALM,CAKD;AAAA,eAAQY,KAAKH,GAAL,CAAS,eAAO;AAC5B,iBAAO,EAACoC,MAAMU,GAAP,EAAYT,OAAOS,GAAnB,EAAP;AACD,SAFa,CAAR;AAAA,OALC,CAAP;AAQD;;;mCAEcrE,I,EAAM;AACnB,aAAO,KAAKF,UAAL,CAAgByC,iBAAhB,CAAkC;AACvCtC,aAAK,KAAKA,GAAL,GAAW,eADuB;AAEvCuC,gBAAQ,KAF+B;AAGvCpC,iBAAS,KAAKA;AAHyB,OAAlC,EAIJU,IAJI,CAIC;AAAA,eAAY2B,SAASC,MAAT,IAAmB,GAAnB,GAAyBD,SAASZ,IAAlC,GAAyC,EAArD;AAAA,OAJD,EAKNf,IALM,CAKD;AAAA,eAAUqD,OAAO5C,GAAP,CAAW;AAAA,iBAAQ,EAACoC,MAAME,GAAP,EAAYD,OAAOC,GAAnB,EAAR;AAAA,SAAX,CAAV;AAAA,OALC,CAAP;AAMD;;;oCAEeP,K,EAAO;AAAA;;AACrB,UAAIgB,SAAS,EAAb;AACA,UAAIhB,UAAU7B,SAAd,EAAyB;AACvB,YAAI6B,MAAMiB,MAAN,CAAa,CAAb,EAAgB,CAAhB,MAAuB,OAA3B,EAAoC;AAClC,iBAAO,KAAKC,QAAL,CAAclB,MAAMiB,MAAN,CAAa,CAAb,EAAgBE,IAAhB,EAAd,CAAP;AACD;AACD,YAAInB,MAAMoB,MAAN,CAAa,CAAb,MAAoB,GAAxB,EAA6B;AAC3BJ,mBAAShB,KAAT;AACD,SAFD,MAEO;AACLgB,mBAAS,MAAMhB,KAAf;AACD;AACF;AACD,aAAO,KAAKqB,wBAAL,CAA8BL,MAA9B,EAAsC;AAAA,eAAK,OAAKxE,UAAL,CAAgByC,iBAAhB,CAAkC;AAClFtC,eAAK,OAAKA,GAAL,GAAW,UAAX,GAAwB2E,CADqD;AAElFpC,kBAAQ,KAF0E;AAGlFpC,mBAAS,OAAKA;AAHoE,SAAlC,EAI/CU,IAJ+C,CAI1C,kBAAU;AAChB,iBAAO,iBAAES,GAAF,CAAM4C,OAAOtC,IAAb,EAAmB,kBAAU;AAClC,mBAAO,EAAC8B,MAAMkB,OAAOrD,EAAd,EAAkBoC,OAAOiB,OAAOrD,EAAhC,EAAP;AACD,WAFM,CAAP;AAGD,SARiD,CAAL;AAAA,OAAtC,CAAP;AASD;;;6BAEQsD,O,EAAS;AAAA;;AAChB,aAAO,KAAKH,wBAAL,CAA8BG,OAA9B,EAAuC;AAAA,eAAK,OAAKhF,UAAL,CAAgByC,iBAAhB,CAAkC;AACnFtC,eAAK,OAAKA,GAAL,GAAW,gBAAX,GAA8B2E,CADgD;AAEnFpC,kBAAQ,KAF2E;AAGnFpC,mBAAS,OAAKA;AAHqE,SAAlC,EAIhDU,IAJgD,CAI3C,kBAAU;AAChB,cAAIiE,WAAW,EAAf;AACA,cAAIZ,OAAOtC,IAAX,EAAiB;AACf,gBAAIA,OAAOsC,OAAOtC,IAAlB;AACA,iBAAK,IAAImD,QAAT,IAAqBnD,IAArB,EAA2B;AACzB,kBAAIA,KAAKiC,cAAL,CAAoBkB,QAApB,CAAJ,EAAmC;AACjCD,2BAAWA,SAASE,MAAT,CAAgBpD,KAAKmD,QAAL,CAAhB,CAAX;AACD;AACF;AACF;AACD,iBAAOD,SAASxD,GAAT,CAAa,eAAO;AACzB,mBAAO,EAACoC,MAAMU,GAAP,EAAYT,OAAOS,GAAnB,EAAP;AACD,WAFM,CAAP;AAGD,SAjBkD,CAAL;AAAA,OAAvC,CAAP;AAkBD;;;6CAEwBhD,M,EAAQ6D,I,EAAM;AACrC,UAAMC,WAAW,KAAKxE,SAAL,CAAeyE,OAAf,CAAuB/D,MAAvB,EAA+B,EAA/B,CAAjB;AACA,aAAO,KAAKlB,CAAL,CAAO6B,GAAP,CAAWmD,SAAS5D,GAAT,CAAa;AAAA,eAAK2D,KAAKN,CAAL,CAAL;AAAA,OAAb,CAAX,EACJ9D,IADI,CACC;AAAA,eAAU,iBAAEmB,OAAF,CAAUkC,MAAV,CAAV;AAAA,OADD,CAAP;AAED;;;mCAEc;AACb,aAAO,KAAKrE,UAAL,CAAgByC,iBAAhB,CAAkC;AACvCtC,aAAK,KAAKA,GAAL,GAAW,SADuB;AAEvCuC,gBAAQ,KAF+B;AAGvCpC,iBAAS,EAAC,gBAAgB,kBAAjB;AAH8B,OAAlC,EAIJU,IAJI,CAIC;AAAA,eAAY2B,SAASZ,IAAT,CAAc,wBAAd,CAAZ;AAAA,OAJD,EAKNwD,KALM,CAKA;AAAA,eAAY,SAAZ;AAAA,OALA,CAAP;AAMD;;;sCAEiB;AAChB,aAAO,KAAKzE,mBAAZ;AACD","file":"datasource.js","sourcesContent":["import _ from \"lodash\";\nimport {Variables} from './variables';\nimport {Capabilities} from './capabilities';\nimport {QueryProcessor} from './queryProcessor';\nimport {modelToString as tagsModelToString} from './tagsKVPairsController';\n\nexport class HawkularDatasource {\n\n  constructor(instanceSettings, $q, backendSrv, templateSrv) {\n    this.type = instanceSettings.type;\n    this.url = instanceSettings.url;\n    this.name = instanceSettings.name;\n    this.q = $q;\n    this.backendSrv = backendSrv;\n    this.headers = {\n      'Content-Type': 'application/json',\n      'Hawkular-Tenant': instanceSettings.jsonData.tenant\n    };\n    if (typeof instanceSettings.basicAuth === 'string' && instanceSettings.basicAuth.length > 0) {\n      this.headers['Authorization'] = instanceSettings.basicAuth;\n    } else if (typeof instanceSettings.jsonData.token === 'string' && instanceSettings.jsonData.token.length > 0) {\n      this.headers['Authorization'] = 'Bearer ' + instanceSettings.jsonData.token;\n    }\n    this.typeResources = {\n      \"gauge\": \"gauges\",\n      \"counter\": \"counters\",\n      \"availability\": \"availability\"\n    };\n    this.variables = new Variables(templateSrv);\n    this.capabilitiesPromise = this.queryVersion().then(version => new Capabilities(version));\n    this.queryProcessor = new QueryProcessor($q, backendSrv, this.variables, this.capabilitiesPromise, this.url, this.headers, this.typeResources);\n  }\n\n  query(options) {\n    const validTargets = options.targets\n      .filter(target => !target.hide)\n      .map(target => {\n        if (target.id === undefined && target.target !== 'select metric') {\n          // backward compatibility\n          target.id = target.target;\n        } else if (target.id === '-- none --') {\n          delete target.id;\n        }\n        return target;\n      })\n      .filter(target => target.id !== undefined\n         || (target.tags !== undefined && target.tags.length > 0)\n         || (target.tagsQL !== undefined && target.tagsQL.length > 0));\n\n    if (validTargets.length === 0) {\n      return this.q.when({data: []});\n    }\n\n    const promises = validTargets.map(target => this.queryProcessor.run(target, options));\n\n    return this.q.all(promises)\n      .then(responses => ({data: _.flatten(responses).sort((m1, m2) => m1.target.localeCompare(m2.target))}));\n  }\n\n  testDatasource() {\n    return this.backendSrv.datasourceRequest({\n      url: this.url + '/metrics',\n      method: 'GET',\n      headers: this.headers\n    }).then(response => {\n      if (response.status === 200 || response.status === 204) {\n        return { status: \"success\", message: \"Data source is working\", title: \"Success\" };\n      } else {\n        return { status: \"error\", message: \"Connection failed (\" + response.status + \")\", title: \"Error\" };\n      }\n    });\n  }\n\n  annotationQuery(options) {\n    return this.backendSrv.datasourceRequest({\n      url: this.url + '/strings/raw/query',\n      data: {\n        start: options.range.from.valueOf(),\n        end: options.range.to.valueOf(),\n        order: 'ASC',\n        ids: [options.annotation.query]\n      },\n      method: 'POST',\n      headers: this.headers\n    }).then(response => response.status == 200 ? response.data[0].data : [])\n    .then(data => data.map(dp => {\n      let annot = {\n        annotation: options.annotation,\n        time: dp.timestamp,\n        title: options.annotation.name,\n        tags: undefined,\n        text: dp.value\n      };\n      if (dp.tags) {\n        let tags = [];\n        for (let key in dp.tags) {\n          if (dp.tags.hasOwnProperty(key)) {\n            tags.push(dp.tags[key].replace(' ', '_'));\n          }\n        }\n        if (tags.length > 0) {\n          annot.tags = tags.join(' ');\n        }\n      }\n      return annot;\n    }));\n  }\n\n  suggestQueries(target) {\n    let url = this.url + '/metrics?type=' + target.type;\n    if (target.tagsQL && target.tagsQL.length > 0) {\n      url += \"&tags=\" + this.variables.resolveToString(target.tagsQL, {});\n    } else if (target.tags && target.tags.length > 0) {\n      url += \"&tags=\" + tagsModelToString(target.tags, this.variables, {});\n    }\n    return this.backendSrv.datasourceRequest({\n      url: url,\n      method: 'GET',\n      headers: this.headers\n    }).then(response => response.status == 200 ? response.data : [])\n    .then(result => {\n      return result.map(m => m.id)\n        .sort()\n        .map(id => {\n          return {text: id, value: id};\n        });\n    });\n  }\n\n  suggestTags(type, key) {\n    if (!key) {\n      return this.q.when([]);\n    }\n    return this.backendSrv.datasourceRequest({\n      url: this.url + '/' + this.typeResources[type] + '/tags/' + key + ':*',\n      method: 'GET',\n      headers: this.headers\n    }).then(result => result.data.hasOwnProperty(key) ? result.data[key] : [])\n    .then(tags => tags.map(tag => {\n      return {text: tag, value: tag};\n    }));\n  }\n\n  suggestTagKeys(type) {\n    return this.backendSrv.datasourceRequest({\n      url: this.url + '/metrics/tags',\n      method: 'GET',\n      headers: this.headers\n    }).then(response => response.status == 200 ? response.data : [])\n    .then(result => result.map(key => ({text: key, value: key})));\n  }\n\n  metricFindQuery(query) {\n    let params = \"\";\n    if (query !== undefined) {\n      if (query.substr(0, 5) === \"tags/\") {\n        return this.findTags(query.substr(5).trim());\n      }\n      if (query.charAt(0) === '?') {\n        params = query;\n      } else {\n        params = \"?\" + query;\n      }\n    }\n    return this.runWithResolvedVariables(params, p => this.backendSrv.datasourceRequest({\n      url: this.url + '/metrics' + p,\n      method: 'GET',\n      headers: this.headers\n    }).then(result => {\n      return _.map(result.data, metric => {\n        return {text: metric.id, value: metric.id};\n      });\n    }));\n  }\n\n  findTags(pattern) {\n    return this.runWithResolvedVariables(pattern, p => this.backendSrv.datasourceRequest({\n      url: this.url + '/metrics/tags/' + p,\n      method: 'GET',\n      headers: this.headers\n    }).then(result => {\n      let flatTags = [];\n      if (result.data) {\n        let data = result.data;\n        for (let property in data) {\n          if (data.hasOwnProperty(property)) {\n            flatTags = flatTags.concat(data[property]);\n          }\n        }\n      }\n      return flatTags.map(tag => {\n        return {text: tag, value: tag};\n      });\n    }));\n  }\n\n  runWithResolvedVariables(target, func) {\n    const resolved = this.variables.resolve(target, {});\n    return this.q.all(resolved.map(p => func(p)))\n      .then(result => _.flatten(result));\n  }\n\n  queryVersion() {\n    return this.backendSrv.datasourceRequest({\n      url: this.url + '/status',\n      method: 'GET',\n      headers: {'Content-Type': 'application/json'}\n    }).then(response => response.data['Implementation-Version'])\n    .catch(response => \"Unknown\");\n  }\n\n  getCapabilities() {\n    return this.capabilitiesPromise;\n  }\n}\n"]}